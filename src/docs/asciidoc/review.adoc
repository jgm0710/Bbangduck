= BbangDuck API Guide
정구민;
:doctype: book
:icons: font
:source-highlighter: highlightjs
:toc: left
:toclevels: 4
:sectlinks:
:operation-curl-request-title: Example request
:operation-http-response-title: Example response
:docinfo: shared-head

[[overview]]
= 개요
== link:/docs/index.html[home]
== 오류 코드

|===
| 발생 API | CAUSE | HTTP_STATUS |CODE | MESSAGE

| <<resources-create-review>> / <<resources-add-survey-to-review>> / <<resources-update-survey-from-review>>
| 인증되지 않은 사용자가 리소스에 접근하는 경우
| 401
| 1401
| 인증되지 않은 사용자가 리소스에 접근했습니다. 인증 토큰을 다시 확인해 주세요.

| <<resources-create-review>> / <<resources-add-survey-to-review>> / <<resources-update-survey-from-review>>
| 탈퇴하거나 활동이 정지된 회원이 리소스에 접근하는 경우
| 403
| 1403
| 해당 리소스에 접근할 수 없는 회원입니다.

| <<resources-create-review>>
| 리뷰를 생성할 테마를 찾을 수 없는 경우
| 404
| 5401
| 해당 테마가 존재하지 않습니다.

| <<resources-create-review>>
| 리뷰 생성 시 등록하는 함께 플레이 한 친구와 인증된 회원과의 관계가 친구 수락 상태가 아닌 경우
| 400
| 2412
| 요청된 두 회원은 서로 친구 관계가 아닙니다.

| <<resources-create-review>>
| 리뷰 생성 시 리뷰의 종류에 상관없이 필수적으로 기입해야하는 사항을 기입하지 않은 경우
| 400
| 4401
| 리뷰 생성 요청 시 기입 사항을 올바르게 기입하지 않았습니다.

| <<resources-create-simple-review>>
| 간단 리뷰 생성 시 간단 리뷰와는 무관한 정보를 기입한 경우
| 400
| 4402
| 간단 리뷰 생성 요청 시 기입 사항을 올바르게 기입하지 않았습니다.

| <<resources-create-detail-review>>
| 상세 리뷰 생성 시 필요한 값을 규칙에 맞게 기입하지 않은 경우
| 400
| 4403
| 상세 리뷰 생성 요청 시 기입 사항을 올바르게 기입하지 않았습니다.

| <<resources-add-survey-to-review>>
| 설문을 추가할 리뷰를 찾을 수 없는 경우
| 404
| 4405
| 해당 리뷰가 존재하지 않습니다.

| <<resources-add-survey-to-review>>
| 설문에 체감 테마 장르 등록 시 해당 장르를 찾을 수 없는 경우
| 404
| 6401
| 해당 장르가 존재하지 않습니다.

| <<resources-add-survey-to-review-not-valid>>
| 리뷰에 설문 등록 시 입력 규칙에 맞게 값을 기입하지 않은 경우
| 400
| 4406
| 리뷰에 설문 추가 시 기입 사항을 올바르게 기입하지 않았습니다.

| <<resources-add-survey-to-review>>
| 리뷰에 설문 등록 시 다른 회원이 생성한 리뷰에 설문을 등록하는 경우
| 403
| 4408
| 다른 회원이 생성한 리뷰에는 설문을 추가할 수 없습니다.

| <<resources-update-survey-from-review-not-valid>>
| 리뷰에 등록된 설문 수정 시 입력 규칙을 지키지 않은 경우
| 400
| 4409
| 리뷰에 등록된 설문 수정 시 기입 사항을 올바르게 기입하지 않았습니다.

| <<resources-update-survey-from-review>>
| 다른 회원이 생성한 리뷰에 등록된 설문을 수정하는 경우
| 403
| 4410
| 다른 회원이 생성한 리뷰의 설문은 수정할 수 없습니다.

| <<resources-update-survey-from-review>>
| 리뷰를 찾을 수 없는 경우
| 404
| 4405
| 해당 리뷰가 존재하지 않습니다.

| <<resources-update-survey-from-review>>
| 등록할 장르를 찾을 수 없는 경우
| 404
| 6401
| 해당 장르가 존재하지 않습니다.

| <<resources-update-survey-from-review>>
| 리뷰에 설문이 등록되어 있지 않았을 경우
| 400
| 4412
| 리뷰에 설문이 등록되어 있지 않으므로, 설문을 수정할 수 없습니다.

| <<resources-get-an-review>>
| 리뷰 조회 시 리뷰를 찾을 수 없는 경우
| 404
| 4405
| 해당 리뷰가 존재하지 않습니다.

|===

== 히스토리

히스토리는 문서의 변경이력을 표시합니다.

2021-05-30:::
* <<resources-create-review>> 기능 구현

2021-05-31:::
* <<resources-create-review>> 수정
** 리뷰 생성 시 테마 클리어 여부를 요청 body 로 받도록 변경
** 변경 사항 문서 반영

2021-06-01:::
* <<resources-get-an-review>> 기능 구현

2021-06-07:::
* <<resources-get-theme-review-list>> 기능 구현

2021-06-07:::
* <<resources-create-review>> 기능 기능 변경
** 간단 리뷰, 상세 리뷰, 상세 및 추가 설문 리뷰로 나누어 생성 요청을 보내던 것을
간단 리뷰, 상세 리뷰로만 나누어 요청
** 설문에 대한 부분은 별도의 요청을 통해서 진행하도록 변경

2021-06-09:::
* <<resources-create-review-over-play-together>> 추가
** 함께한 친구가 많을 경우에 대한 입력값 제한 설정

2021-06-10:::
* <<resources-add-survey-to-review>> 기능 구현

2021-06-11:::
* <<resources-update-survey-from-review>> 기능 구현

[[resources-review]]
= 리뷰 관련 리소스

[[resources-create-review]]
== 리뷰 생성

* `POST` `/api/themes/{themeId}/reviews`

* 리뷰의 종류는 간단 리뷰, 상세 리뷰로 나뉩니다.
** 2 종류의 리뷰 생성을 하나의 API 요청을 통해 관리합니다.
** 각 리뷰의 종류에 따라 입력 규칙이 달라집니다.

* 인증된 회원이 테마에 대한 리뷰를 생성합니다.
** 리뷰를 작성하는 회원에 대한 정보는 X-AUTH-TOKEN 을 통해서 얻어집니다.
** 인증되지 않은 사용자는 해당 리소스에 접근이 불가능합니다.

* 요청이 성공하면 status, message 가 응됩니다. 별도의 data 는 응답되지 않습니다.
** 생성된 리뷰에 대한 정보를 조회하려면 리뷰 조회 리소스를 통해 조회하면 됩니다.
** 응답 Header 에 Location 부분에 리뷰 조회 API 요청에 대한 URL 값이 있습니다.

* 리뷰에 함께한 친구를 등록할 경우 인증된 회원과 실제 친구 관계인 회원이 아니면 해당 요청은 실패합니다.

* 리뷰에 이미지를 등록할 경우 이미지 파일 업로드 리소스를 통해 이미지 파일을 업로드 하고, 해당 요청에 응답으로 나온 파일 정보를 통해
리뷰에 등록힐 이미지 파일에 대한 정보를 기입합니다.

[[resources-create-review-fail]]
=== 리뷰 생성 실패

[[resources-create-review-empty]]
==== 리뷰 생성 실패 - 아무 정보도 입력하지 않은 경우

* 응답 HttpStatus : `400 Bad Request`

operation::create-review-empty[snippets='response-fields,curl-request,http-response']

[[resources-create-review-over-play-together]]
==== 리뷰 생성 실패 - 함께 플레이 한 친구의 수가 제한된 수보다 많을 경우

* 응답 HttpStatus : `400 Bad Request`

* 리뷰 생성 시 함께 플레이 한 친구로 등록된 친구의 수가 제한된 개수보다 많을 경우 요청에 실패합니다.

operation::create-review-over-play-together[snippets='response-fields,curl-request,http-response']

[[resources-create-simple-review]]
=== 간단 리뷰 생성

* 간단 리뷰 생성의 경우 Review Type 을 `SIMPLE` 로 기입해야 합니다.

* 간단 리뷰 생성의 경우 리뷰 타입, 테마 클리어 여부, 테마 클리어 시간, 힌트 사용 개수, 테마 평점, 함께 플레이한 친구 ID 목록 만을 기입할 수 있습니다.
** 함께 플레이한 친구 ID 목록은 기입하지 않아도 상관없으나, 다른 정보는 반드시 기입해야 합니다.

[[resources-create-simple-review-success]]
==== 간단 리뷰 생성 성공

* 응답 HttpStatus : `201 Created`

operation::create-simple-review-success[snippets='request-headers,request-fields,response-fields,curl-request,http-response']

[[resources-create-simple-review-request-over-data]]
==== 간단 리뷰 생성 시 간단 리뷰와는 무관한 정보를 기입한 경우

* 응답 HttpStatus : `400 Bad Request`

* Review Type 이 `SIMPLE` 일 경우 상세 리뷰에 해당하는 정보를 기입하면 요청에 실패합니다.

operation::create-simple-review-request-over-data[snippets='response-fields,curl-request,http-response']

[[resources-create-detail-review]]
=== 상세 리뷰 생성

* 상세 리뷰 생성의 경우 Review Type 을 `DETAIL` 로 기입해야 합니다.

* 상세 리뷰 생성의 경우 리뷰 타입, 테마 클리어 여부, 테마 클리어 시간, 힌트 사용 개수, 테마 평점, 함께 플레이한 친구 ID 목록, 이미지 파일 목록에 대한 정보, 코멘트 만을 기입할 수 있습니다.
** 함께 플레이한 친구 ID 목록과 이미지 파일에 대한 정보는 기입하지 않아도 상관없으나, 다른 정보는 반드시 기입해야 합니다.

[[resources-create-detail-review-success]]
==== 상세 리뷰 생성 성공

* 응답 HttpStatus : `201 Created`

operation::create-detail-review-success[snippets='request-headers,request-fields,response-fields,curl-request,http-response']

[[resources-create-detail-review-request-over-data]]
==== 상세 리뷰 생성 시 관련된 정보를 제대로 기입하지 않은 경우

* 응답 HttpStatus : `400 Bad Request`

* 상세 리뷰 생성 시 상세 리뷰에 대한 입력 규칙을 맞추지 않았을 경우 해당 응답이 나타납니다.

* 다음의 경우에 해당 응답이 나타납니다.
** 코멘트에 대한 정보를 기입하지 않은 경우
** 이미지 파일 목록 등록 시, 파일 저장소 ID 는 기입하였으나, 파일 이름을 기입하지 않은 경우
** 이미지 파일 목록 등록 시, 파일 이름은 기입하였으나, 파일 저장소 ID 는 기입하지 않은 경우

operation::create-detail-review-comment-empty[snippets='response-fields,curl-request,http-response']

[[resources-add-survey-to-review]]
== 리뷰에 설문 추가

* `POST` `/api/reviews/{reviewId}/surveys`

* 리뷰에 설문 추가 리소스는 생성된 리뷰에 리뷰를 등록하는 테마에 대한 설문을 추가합니다.

* 설문 추가는 리뷰가 생성된 이후 7일 이내에만 추가가 가능합니다.

* 해당 리소스는 인증된 사용자만 접근이 가능하며, 다른 회원이 생성한 리뷰에는 설문을 등록할 수 없습니다.

* 설문 등록 시 주어진 모든 값을 기입해야 하며, 입력하지 않았을 경우 요청에 실패합니다.
** 추가로 설문 등록 시 체감 테마 장르는 제한된 개수 이내에만 등록이 가능합니다.
** 체감 테마 장르 기입 시 제한된 개수 이상을 기입할 경우 요청에 실패합니다.


[[resources-add-survey-to-review-success]]
=== 리뷰에 설문 추가 성공

* 응답 HttpStatus : `No Content`

* 별도의 응답 Body Data 는 없습니다.

operation::add-survey-to-review-success[snippets='request-headers,request-fields,response-fields,curl-request,http-response']

[[resources-add-survey-to-review-not-valid]]
=== 리뷰에 설문 추가 시 값을 제대로 기입하지 않은 경우

* 응답 HttpStatus : `400 Bad Request`

* 리뷰에 설문 추가 시 주어진 값을 모두, 정해진 값대로 기입하지 않은 경우 요청에 실패합니다.

operation::add-survey-to-review-not-valid[snippets='response-fields,curl-request,http-response']

[[resources-add-survey-to-review-over-perceived-theme-genres-count]]
=== 리뷰에 설문 추가 시 등록하는 체감 테마 장르의 수가 제한된 개수보다 많을 경우

* 응답 HttpStatus : `400 Bad Request`

* 설문 등록 시 체감 테마 장르를 기입하게 되는데, 제한된 개수보다 많은 수의 장르 코드를 기입한 경우 요청에 실패합니다.

operation::add-survey-to-review-over-perceived-theme-genres-count[snippets='response-fields,curl-request,http-response']

[[resources-add-survey-to-review-period-expiration]]
=== 리뷰에 설문 추가 시 설문 추가 가능 기간이 지난 경우

* 응답 HttpStatus : `400 Bad Request`

* 리뷰에 설문 추가는 리뷰를 생성한지 7일 이내에만 진행할 수 있습니다.

* 리뷰를 생성한 지 7일 이후 설문을 등록할 경우 요청에 실패합니다.

* 해당 기간은 추후 변동될 수 있습니다.

operation::add-survey-to-review-period-expiration[snippets='response-fields,curl-request,http-response']

[[resources-update-survey-from-review]]
== 리뷰에 등록된 설문 수정

* `PUT` `/api/reviews/{reviewId}/surveys`

* 리뷰에 등록된 설문의 내용을 수정합니다.

* 인증된 회원만 해당 리소스에 접근이 가능하고, 다른 회원이 생성한 리뷰에 등록된 설문은 수정할 수 없습니다.

* 설문 수정 시 등록하는 체감 테마 장르는 제한된 개수 만큼만 기입할 수 있습니다.

* 설문 수정은 리뷰를 생성한 지 7일 이내에만 가능합니다.
** 해당 기간은 추후 변경될 수 있습니다.

* 리뷰에 설문이 등록되어 있지 않았을 경우 요청은 실패합니다.

[[resources-update-survey-from-review-success]]
=== 리뷰에 등록된 설문 수정 성공

* 응답 HttpStatus : `204 No Content`

* 별도의 응답 Data 는 없습니다.

operation::update-survey-from-review-success[snippets='request-headers,request-fields,response-fields,curl-request,http-response']

[[resources-update-survey-from-review-not-valid]]
=== 리뷰에 등록된 설문 수정 - 입력 규칙을 지키지 않은 경우

* 응답 HttpStatus : `400 Bad Request`

* 리뷰에 등록된 설문 수정 시 기입해야하는 값을 기입하지 않았거나, 장르 코드를 제한된 개수보다 많이 기입하는 경우 요청에 실패합니다.

operation::update-survey-from-review-not-valid[snippets='response-fields,curl-request,http-response']

[[resources-update-survey-from-review-over-perceived-theme-genres-count]]
=== 리뷰에 등록된 설문 수정 - 체감 테마 장르의 수를 제한된 개수보다 많이 기입한 경우

* 응답 HttpStatus : `400 Bad Request`

* 설문 수정 시 체감 테마 장르를 정해진 개수보다 많이 기입할 경우 요청에 실패합니다.

operation::update-survey-from-review-over-perceived-theme-genres-count[snippets='response-fields,curl-request,http-response']

[[resources-update-survey-from-review-period-expiration]]
=== 리뷰에 등록된 설문 수정 - 설문 수정 가능 기간이 만료된 경우

* 응답 HttpStatus : `409 Conflict`

* 설문 수정은 리뷰를 생성한 지 7일 이내에만 가능합니다.

operation::update-survey-from-review-period-expiration[snippets='response-fields,curl-request,http-response']


[[resources-get-an-review]]
== 리뷰 1건 조회

* `GET` `/api/reviews/{reviewId}`

* 리뷰 조회의 경우 조회의 결과로 간단 리뷰, 상세 리뷰, 상세 및 추가 설문 리뷰가 다른 응답 형태로 나타날 수 있습니다.

* 간단 리뷰의 경우 `ReviewType` 은 `SIMPLE`, 상세 리뷰의 경우 `ReviewType` 은 `DETAIL`, 상세 및 추가 설문 작성 리뷰의 경우 `ReviewType` 은 `DEEP`
의 값으로 나타납니다.

* 리뷰 조회의 경우 인증되지 않은 사용자도 리뷰를 조회할 수 있습니다.
** 다만 인증되지 않은 사용자의 경우 리뷰에 좋아요를 등록하는 등의 요청을 하기 위해서는 인증의 단계를 거쳐야 합니다.
** 인증되지 않은 회원의 `myReview` 는 `false`, `like` 도 `false` 가 나타납니다.

* 인증된 회원이 자신이 생성한 리뷰를 조회하는 경우 `myReview` 는 `true` 가 됩니다.
** 자신이 생성한 리뷰에 대해서는 좋아요를 등록하는 등의 요청이 불가능합니다.
** 자신이 생성한 리뷰는 좋아요 버튼이 나오지 않도록 하는 등의 구현이 가능할 것 입니다.

* 인증된 회원이 다른 회원이 생성한 리뷰를 조회하는 경우 리뷰에 좋아요를 등록하는 등의 요청을 수행할 수 있습니다.
** 인증된 회원이 해당 리뷰에 좋아요를 등록했을 경우, `like` 는 `true` 가 나타납니다.
** 인증된 회원이 해당 리뷰에 좋아요를 등록하지 않았을 경우, `like` 는 `false` 가 나타납니다.

[[resources-get-simple-review]]
=== 간단 리뷰가 조회된 경우

* 응답 HttpStatus : `200 OK`

* ReviewType : `SIMPLE`

* 아래의 예시는 리뷰를 생성한 회원 A 가 있고, 리뷰를 조회하는 회원 B 가 있는 상황입니다.

* B 는 A 가 생성한 리뷰에 좋아요를 등록한 상황입니다.
* `myReview` 는 `false`, `like` 는 `true` 가 나오게 됩니다.

NOTE: 상세 리뷰 또한 위의 상황을 가정합니다.

operation::get-simple-review-of-different-member-success[snippets='request-headers,response-fields,curl-request,http-response']

[[resources-get-detail-review]]
=== 상세 리뷰가 조회된 경우

* 응답 HttpStatus : `200 OK`

* ReviewType : `DETAIL`

operation::get-detail-review-of-different-member-success[snippets='request-headers,response-fields,curl-request,http-response']

[[resources-get-theme-review-list]]
== 테마에 등록된 리뷰 목록 조회

* `GET` `/api/themes/{themeId}/reviews?{parameters}`

* 테마에 등록된 리뷰 목록 조회의 경우, 간단 리뷰, 상세 리뷰, 상세 및 추가 설문 작성 리뷰가 모두 응답됩니다.
** 세 Review Type 에 따라 다른 응답 형태를 띕니다. (나타내는 데이터의 양이 다름)

NOTE: 각 응답 형태에 대한 부분은 리뷰 1건 조회 리소스를 참고하세요.

* 해당 리소스는 인증되지 않은 사용자도 접근이 가능합니다.

* 인증된 사용자는 리뷰 목록 조회 중 해당 리뷰가 자신이 생성한 리뷰인지, 다른 회원이 생성한 리뷰인지를
`myReview` 를 통해 알 수 있습니다.
** 자신이 생성한 리뷰는 `myReview` 가 `true`, 다른 회원이 생성한 리뷰는 `myReview` 가 `false` 로 나타납니다.

* 리뷰 목록 조회에 성공한 경우, 간단한 페이징 정보와 이전, 다음 페이지 요청에 해당하는 URL 을 응답 받습니다.
** 총 페이지 개수 기준 이전 페이지가 없다면 (이전 페이지가 0 페이지 이거나, 아예 잘못된 요청을 통해 이전 페이지가 총 페이지 수 보다 클 경우)
`prevPageUrl` 은 `null` 이 나옵니다.
** 마찬가지로 총 페이지 개수 기준 다음 페이지가 없다면 (다음 페이지가 총 페이지 수 보다 클 경우) `nextPageUrl` 은 `null` 이 나옵니다.


[[resources-get-theme-review-list-success]]
=== 테마에 등록된 리뷰 목록 조회 성공

응답 HttpStatus : `200 OK`

operation::get-theme-review-list-success[snippets='request-headers,request-parameters,response-fields,curl-request,http-response']


